<div class="text-center">
    <p><button id="toggleButton" onclick="toggleConnection();">Open Connection</button></p>
    <p><button onclick="send();">Send</button></p>
    <p><input id="wbinput" type="text" /></p>
    <p id="answerbox">Received: </p> <!-- Инициализируем текст сразу -->
    <p id="errorbox" style="color: red;"></p> <!-- Для отображения ошибок -->

    <script>
                var testsocket = null;

        function updateButtonText() {
                    const button = document.getElementById("toggleButton");
            button.innerHTML = testsocket && testsocket.readyState === WebSocket.OPEN ? "Close Connection" : "Open Connection";
        }

        function toggleConnection() {
            if (testsocket === null || testsocket.readyState === WebSocket.CLOSED) {
                openConnection();
                    } else if (testsocket.readyState === WebSocket.OPEN) {
                closeConnection();
            }
            updateButtonText();
                }

                function openConnection() {
                    testsocket = new WebSocket("ws://localhost:52928/ws");

                    testsocket.onopen = function () {
                        updateButtonText(); // Обновляем текст кнопки при открытии
                        document.getElementById("errorbox").innerHTML = ""; // Очищаем ошибки
                        console.log("WebSocket connection opened");
                    }

                    testsocket.onclose = function () {
                        updateButtonText(); // Обновляем текст кнопки при закрытии
                        document.getElementById("errorbox").innerHTML = ""; // Очищаем ошибки
                        console.log("WebSocket connection closed");
                    }

                    testsocket.onerror = function (e) {
                        console.error("Error: " + e.message);
                    }

                    testsocket.onmessage = function (e) {
                        // Оставляем "Received: " и обновляем только сообщение
                        document.getElementById("answerbox").innerHTML = "Received: " + e.data;
                    }
                }

                function closeConnection() {
                    if (testsocket !== null && testsocket.readyState === WebSocket.OPEN) {
                        testsocket.close();
                        console.log("Closing WebSocket connection...");
                    }
                }

                function send() {
                    const message = document.getElementById("wbinput").value.trim(); // Убираем пробелы

                    if (testsocket !== null && testsocket.readyState === WebSocket.OPEN) {
                        if (message === "") {
                            document.getElementById("errorbox").innerHTML = "Cannot send an empty message!";
                            console.warn("Cannot send an empty message!");
                        } else {
                            testsocket.send(message);
                            document.getElementById("errorbox").innerHTML = ""; // Очищаем ошибки
                        }
                    } else {
                        document.getElementById("errorbox").innerHTML = "WebSocket connection is closed! Cannot send message.";
                        console.warn("WebSocket connection is not open!");
                    }
                }
    </script>
</div>
